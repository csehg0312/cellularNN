import{b as i,o as fe,k as xe,i as s,j as V,c as Se,a as w,F as $e,d as ye,t as u}from"./index-BmTam7tY.js";var _e=u('<div class="text-white p-4"><h2 class="text-2xl font-bold mb-4">Video WebRTC</h2><div class=mb-4><h3 class="text-xl font-semibold mb-2">Settings:</h3><div class="border border-black shadow-md mx-auto flex flex-col px-2 gap-2"><button class="self-end text-gray-500 hover:text-gray-700"></button></div><h3 class="text-xl font-semibold mt-4 mb-2">Video Devices</h3><div><label for=video-input class=mr-2>Video Input:</label><select id=video-input class="text-black p-2 border rounded"></select></div></div><div class=mb-4><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">Start</button><button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Stop</button></div><h3 class="text-xl font-semibold mb-2">Data Channel</h3><pre id=data-channel class="bg-gray-700 p-2 rounded">Loaded when connection made<br></pre><h3 class="text-xl font-semibold mb-2">ICE Connection State</h3><p id=ice-connection-state></p><h3 class="text-xl font-semibold mb-2">ICE Gathering State</h3><p id=ice-gathering-state></p><h3 class="text-xl font-semibold mb-2">Signaling State</h3><p id=signaling-state></p><h3 class="text-xl font-semibold mb-2">SDP Offer</h3><pre id=offer-sdp class="bg-gray-700 p-2 rounded overflow-auto max-h-40">Loaded when connection made<br></pre><h3 class="text-xl font-semibold mb-2">SDP Answer</h3><pre id=answer-sdp class="bg-gray-700 p-2 rounded overflow-auto max-h-40">Loaded when connection made<br></pre><div id=media><h3 class="text-xl font-semibold mb-2">Media</h3><video id=video autoplay playsinline class="w-full max-w-lg mx-auto">'),we=u('<div class="bg-red-900 border border-white-900 text-white px-4 py-3 rounded mb-4"role=alert><p>'),Ce=u('<label for=use-datachannel class="flex items-center"><input type=checkbox id=use-datachannel class=mr-2>Use Datachannel?'),ke=u('<select id=datachannel-parameters class="text-black p-2 border rounded"><option value="{&quot;ordered&quot;: true}">Ordered, reliable</option><option value="{&quot;ordered&quot;: false, &quot;maxRetransmits&quot;: 0}">Unordered, no retransmissions</option><option value="{&quot;ordered&quot;: false, &quot;maxPacketLifetime&quot;: 500}">Unordered, 500ms lifetime'),Ie=u('<select id=video-codec class="text-black p-2 border rounded"><option value=default selected>Default codecs</option><option value=VP8/90000>VP8</option><option value=H264/90000>H264'),Le=u('<select id=video-resolution class="text-black p-2 border rounded"><option value=""selected>Default resolution</option><option value=320x240>320x240</option><option value=640x480>640x480</option><option value=960x540>960x540</option><option value=1280x720>1280x720'),Ee=u('<label for=use-stun class="flex items-center"><input type=checkbox id=use-stun class=mr-2>Use STUN?'),De=u("<option>");const Te=()=>{const[M,b]=i(""),[G,R]=i(""),[U,N]=i(""),[j,B]=i(""),[F,A]=i(""),[H,J]=i(""),[C,W]=i(null),[z,K]=i(!0),[Q,k]=i(!1),[X,Y]=i(!1),[Z,ee]=i([]),[I,L]=i(""),[v,te]=i(!0);let e=null,d=null,E=null;const ne=()=>{const t={sdpSemantics:"unified-plan",iceServers:document.getElementById("use-stun").checked?[{urls:["stun:stun.l.google.com:19302"]}]:[]};return e=new RTCPeerConnection(t),e.addEventListener("icegatheringstatechange",()=>{N(n=>n+" -> "+e.iceGatheringState)}),e.addEventListener("iceconnectionstatechange",()=>{R(n=>n+" -> "+e.iceConnectionState)}),e.addEventListener("signalingstatechange",()=>{B(n=>n+" -> "+e.signalingState)}),e.addEventListener("track",n=>{n.track.kind==="video"&&(document.getElementById("video").srcObject=n.streams[0])}),e},oe=async()=>{try{const n=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput");ee(n),n.length>0&&L(n[0].deviceId)}catch(t){W("Failed to get video devices: "+t.message)}},ae=async()=>{try{const t=await e.createOffer();await e.setLocalDescription(t),await new Promise(l=>{if(e.iceGatheringState==="complete")l();else{const g=()=>{e.iceGatheringState==="complete"&&(e.removeEventListener("icegatheringstatechange",g),l())};e.addEventListener("icegatheringstatechange",g)}});const n=e.localDescription;let r=n.sdp;A(r);const o=await(await fetch("/offer",{body:JSON.stringify({sdp:r,type:n.type}),headers:{"Content-Type":"application/json"},method:"POST"})).json();J(o.sdp),await e.setRemoteDescription(o)}catch(t){console.error(t)}},ie=async()=>{K(!1),e=ne();let t=null;const n=()=>t===null?(t=new Date().getTime(),0):new Date().getTime()-t;if(document.getElementById("use-datachannel").checked){const p=JSON.parse(document.getElementById("datachannel-parameters").value);d=e.createDataChannel("chat",p),d.addEventListener("close",()=>{clearInterval(E),b(o=>o+`- close
`)}),d.addEventListener("open",()=>{b(o=>o+`- open
`),E=setInterval(()=>{const o=`ping ${n()}`;b(l=>l+`> ${o}
`),d.send(o)},1e3)}),d.addEventListener("message",o=>{if(b(l=>l+`< ${o.data}
`),o.data.substring(0,4)==="pong"){const l=n()-parseInt(o.data.substring(5),10);b(g=>g+` RTT ${l} ms
`)}})}const r={video:{deviceId:{exact:I()}}};try{const p=await navigator.mediaDevices.getUserMedia(r);p.getTracks().forEach(o=>{e.addTrack(o,p)}),Y(!0),await ae()}catch(p){console.error("Could not acquire media:",p)}k(!0)},se=()=>{k(!1),d&&d.close(),e.getTransceivers&&e.getTransceivers().forEach(t=>{t.stop&&t.stop()}),e.getSenders().forEach(t=>{t.track.stop()}),setTimeout(()=>{e.close()},500)};return fe(()=>{oe()}),xe(()=>{d&&d.close(),e&&e.close()}),(()=>{var t=_e(),n=t.firstChild,r=n.nextSibling,p=r.firstChild,o=p.nextSibling,l=o.firstChild,g=o.nextSibling,le=g.nextSibling,re=le.firstChild,f=re.nextSibling,D=r.nextSibling,h=D.firstChild,x=h.nextSibling,ce=D.nextSibling,S=ce.nextSibling,de=S.firstChild;de.nextSibling;var pe=S.nextSibling,P=pe.nextSibling,ue=P.nextSibling,T=ue.nextSibling,ge=T.nextSibling,q=ge.nextSibling,be=q.nextSibling,$=be.nextSibling,me=$.firstChild;me.nextSibling;var he=$.nextSibling,y=he.nextSibling,ve=y.firstChild;ve.nextSibling;var O=y.nextSibling;return s(t,(()=>{var a=V(()=>!!C());return()=>a()&&(()=>{var c=we(),m=c.firstChild;return s(m,C),c})()})(),r),l.$$click=()=>te(!v()),s(l,()=>v()?"▼ Close":"▶ Open"),s(o,(()=>{var a=V(()=>!!v());return()=>a()&&[Ce(),ke(),Ie(),Le(),Ee()]})(),null),f.addEventListener("change",a=>L(a.target.value)),s(f,Se($e,{get each(){return Z()},children:a=>(()=>{var c=De();return s(c,()=>a.label||`Video Device ${a.deviceId.substr(0,5)}`),w(()=>c.value=a.deviceId),c})()})),h.$$click=ie,x.$$click=se,s(S,M,null),s(P,G),s(T,U),s(q,j),s($,F,null),s(y,H,null),w(a=>{var c=z()?"inline-block":"none",m=Q()?"inline-block":"none",_=X()?"block":"none";return c!==a.e&&((a.e=c)!=null?h.style.setProperty("display",c):h.style.removeProperty("display")),m!==a.t&&((a.t=m)!=null?x.style.setProperty("display",m):x.style.removeProperty("display")),_!==a.a&&((a.a=_)!=null?O.style.setProperty("display",_):O.style.removeProperty("display")),a},{e:void 0,t:void 0,a:void 0}),w(()=>f.value=I()),t})()};ye(["click"]);export{Te as default};
